if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(t){const e=this.constructor;return this.then((i=>e.resolve(t()).then((()=>i))),(i=>e.resolve(t()).then((()=>{throw i}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const t=uni.requireGlobal();ArrayBuffer=t.ArrayBuffer,Int8Array=t.Int8Array,Uint8Array=t.Uint8Array,Uint8ClampedArray=t.Uint8ClampedArray,Int16Array=t.Int16Array,Uint16Array=t.Uint16Array,Int32Array=t.Int32Array,Uint32Array=t.Uint32Array,Float32Array=t.Float32Array,Float64Array=t.Float64Array,BigInt64Array=t.BigInt64Array,BigUint64Array=t.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(t){"use strict";function e(t,e,...i){uni.__log__?uni.__log__(t,e,...i):console[t].apply(console,[...i,e])}__definePage("pages/index/index",((t,e)=>{const i=t.__vccOpts||t;for(const[r,o]of e)i[r]=o;return i})({data:()=>({boardSize:uni.getSystemInfoSync().windowWidth,gridNum:17,pieceSize:0,board:[],currentPlayer:1,context:null,confirmed:!1,lastMove:null,scale:1,animationTimer:null}),onLoad(){this.audioContext=uni.createInnerAudioContext(),this.audioContext.src="/static/audio/music.mp3",this.audioContext.onEnded((()=>{e("log","at pages/index/index.vue:41","音频播放结束")})),this.audioContext.onError((t=>{e("error","at pages/index/index.vue:45","音频播放出错",t)}))},onReady(){this.initGame()},methods:{initGame(){this.board=Array(this.gridNum).fill().map((()=>Array(this.gridNum).fill(0))),this.pieceSize=this.boardSize/(this.gridNum+1),this.context=uni.createCanvasContext("gobang",this),this.drawBoard()},drawBoard(){const t=this.context;t.setFillStyle("#bca761"),t.fillRect(0,0,this.boardSize,this.boardSize),t.setStrokeStyle("#1f1f1f"),t.setLineWidth(.8);for(let e=0;e<this.gridNum;e++)t.moveTo(this.pieceSize,this.pieceSize*(e+1)),t.lineTo(this.boardSize-this.pieceSize,this.pieceSize*(e+1)),t.moveTo(this.pieceSize*(e+1),this.pieceSize),t.lineTo(this.pieceSize*(e+1),this.boardSize-this.pieceSize);t.stroke();for(let e=0;e<this.gridNum;e++)for(let t=0;t<this.gridNum;t++)0!==this.board[e][t]&&this.drawPiece(e,t,this.board[e][t]);t.draw()},drawPiece(t,e,i){const r=this.context,o=(e+1)*this.pieceSize,a=(t+1)*this.pieceSize;let n=.4*this.pieceSize;if(!this.confirmed&&this.lastMove&&t===this.lastMove.row&&e===this.lastMove.col&&(n*=this.scale,r.setGlobalAlpha(.7)),r.setShadow(2,2,4,"rgba(0, 0, 0, 0.15)"),r.beginPath(),r.arc(o,a,n,0,2*Math.PI),1===i){const t=r.createCircularGradient(o,a,n);t.addColorStop(0,"#4A4A4A"),t.addColorStop(1,"#000000"),r.setFillStyle(t)}else{const t=r.createCircularGradient(o,a,n);t.addColorStop(0,"#FFFFFF"),t.addColorStop(1,"#E0E0E0"),r.setFillStyle(t)}r.fill(),2===i&&(r.setStrokeStyle("rgba(0, 0, 0, 0.1)"),r.stroke()),r.setShadow(0,0,0,"rgba(0, 0, 0, 0)"),r.setGlobalAlpha(1)},handleTap(t){if(this.confirmed)return;const e=t.target,i=t.detail.x-e.offsetLeft,r=t.detail.y-e.offsetTop,o=Math.round(i/this.pieceSize-1),a=Math.round(r/this.pieceSize-1);o>=0&&o<this.gridNum&&a>=0&&a<this.gridNum&&0===this.board[a][o]&&(this.lastMove&&(this.board[this.lastMove.row][this.lastMove.col]=0),this.board[a][o]=this.currentPlayer,this.lastMove={row:a,col:o},this.startAnimation(),this.drawBoard(),this.audioContext.play())},confirmMove(){this.lastMove&&!this.confirmed&&(this.confirmed=!0,this.stopAnimation(),this.drawBoard(),this.checkWin(this.lastMove.row,this.lastMove.col)?setTimeout((()=>{uni.showModal({title:"游戏结束",content:(1===this.currentPlayer?"黑棋":"白棋")+"获胜！",showCancel:!1,success:()=>{this.resetGame()}})}),100):(this.currentPlayer=1===this.currentPlayer?2:1,this.confirmed=!1,this.lastMove=null))},checkWin(t,e){const i=[[1,0],[0,1],[1,1],[1,-1]];for(const[r,o]of i){let i=1;for(let a=1;a<5;a++){const n=t+r*a,s=e+o*a;if(n<0||n>=this.gridNum||s<0||s>=this.gridNum||this.board[n][s]!==this.currentPlayer)break;i++}for(let a=1;a<5;a++){const n=t-r*a,s=e-o*a;if(n<0||n>=this.gridNum||s<0||s>=this.gridNum||this.board[n][s]!==this.currentPlayer)break;i++}if(i>=5)return!0}return!1},startAnimation(){this.stopAnimation();let t=!0;this.scale=1,this.animationTimer=setInterval((()=>{t?(this.scale+=.05,this.scale>=1.2&&(t=!1)):(this.scale-=.05,this.scale<=.8&&(t=!0)),this.drawBoard()}),50)},stopAnimation(){this.animationTimer&&(clearInterval(this.animationTimer),this.animationTimer=null),this.scale=1},resetGame(){this.currentPlayer=1,this.confirmed=!1,this.lastMove=null,this.stopAnimation(),this.initGame()}}},[["render",function(e,i,r,o,a,n){return t.openBlock(),t.createElementBlock("view",{class:"container"},[t.createElementVNode("button",{class:t.normalizeClass(["top-button",{disabled:2!==a.currentPlayer||a.confirmed}]),onClick:i[0]||(i[0]=(...t)=>n.confirmMove&&n.confirmMove(...t))},[t.createElementVNode("text",{class:"rotated-text"},t.toDisplayString(2!==a.currentPlayer||a.confirmed?"未到你回合":"确认落子"),1)],2),t.createElementVNode("canvas",{"canvas-id":"gobang",id:"gobang",onClick:i[1]||(i[1]=(...t)=>n.handleTap&&n.handleTap(...t)),style:t.normalizeStyle({width:a.boardSize+"px",height:a.boardSize+"px"})},null,4),t.createElementVNode("button",{class:t.normalizeClass(["bottom-button",{disabled:1!==a.currentPlayer||a.confirmed}]),onClick:i[2]||(i[2]=(...t)=>n.confirmMove&&n.confirmMove(...t))},t.toDisplayString(1!==a.currentPlayer||a.confirmed?"未到你回合":"确认落子"),3)])}]]));const i={onLaunch:function(){e("log","at App.vue:4","App Launch")},onShow:function(){e("log","at App.vue:7","App Show")},onHide:function(){e("log","at App.vue:10","App Hide")}};const{app:r,Vuex:o,Pinia:a}={app:t.createVueApp(i)};uni.Vuex=o,uni.Pinia=a,r.provide("__globalStyles",__uniConfig.styles),r._component.mpType="app",r._component.render=()=>{},r.mount("#app")}(Vue);
